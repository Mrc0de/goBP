{{define "style"}}
    <style>
        .mostOfScreen {
            min-height:80vh;
        }
    </style>
{{end}}

{{template "head" .}}

    <div class="content">
        <div class="col-sm-12">
            <div class="row">
                <div class="card col-sm-12 ">
                    <div class="card-header header-info text-black">
                        {{.Ip}}
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <textarea class="col-sm-12 mostOfScreen bg-dark text-white" id="output" disabled></textarea>
                        </div>
                        <div class="row">
                            <input id="input" class="form-control bg-dark text-white" type="text" /></br>
                            <button onclick="send()">Send</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        scrollBottom = function(el) {
            return el.scrollTop = el.scrollHeight;
        };
        var input = document.getElementById("input");
        var output = document.getElementById("output");
        var socket = new WebSocket("ws://{{.Conf.WsHost}}/live");

        function tryParseJSON (jsonString){
            try {
                var o = JSON.parse(jsonString);
                if (o && typeof o === "object") {
                    return o;
                }
            }
            catch (e) { }
            return false;
        };

        socket.onopen = function () {
            output.innerHTML += "Status: Connected\n";
        };

        socket.onmessage = function (e) {
            let jObj = tryParseJSON(e.data);
            if ( jObj ) {
                switch(jObj.type) {
                    case 'heartbeat': {
                        break;
                    }
                    case 'ticker' : {
                        break;
                    }
                    case 'chatRaw':{
                        break;
                    }
                }
            } else {
                output.innerHTML += e.data + "\n";
            }
            scrollBottom(output);
        };

        socket.onerror = function (ev) {
            $('#output').append("Connection Error...\n");
        }

        socket.onclose = function () {
            $('#output').append("Connection Lost.\n");
        }

        function send() {
            socket.send(input.value);
            input.value = "";
        }
    </script>
{{template "foot"}}
